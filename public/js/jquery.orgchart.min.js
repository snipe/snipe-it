"use strict";var factory;factory=function(e,t,i,n){var s=function(t,i){this.$chartContainer=e(t),this.opts=i,this.defaultOptions={nodeTitle:"name",nodeId:"id",toggleSiblingsResp:!1,visibleLevel:999,chartClass:"",exportButton:!1,exportButtonName:"Export",exportFilename:"OrgChart",exportFileextension:"png",parentNodeSymbol:"oci-leader",draggable:!1,direction:"t2b",pan:!1,zoom:!1,zoominLimit:7,zoomoutLimit:.5}};s.prototype={init:function(t){var i=this;this.options=e.extend({},this.defaultOptions,this.opts,t);var n=this.$chartContainer;this.$chart&&this.$chart.remove();var s=this.options.data,o=this.$chart=e("<div>",{data:{options:this.options},class:"orgchart"+(""!==this.options.chartClass?" "+this.options.chartClass:"")+("t2b"!==this.options.direction?" "+this.options.direction:""),click:function(t){e(t.target).closest(".node").length||o.find(".node.focused").removeClass("focused")}});"undefined"!=typeof MutationObserver&&this.triggerInitEvent();var a=o.append(e('<ul class="nodes"><li class="hierarchy"></li></ul>')).find(".hierarchy");return"object"===e.type(s)?s instanceof e?this.buildHierarchy(a,this.buildJsonDS(s.children()),0,this.options):this.buildHierarchy(a,this.options.ajaxURL?s:this.attachRel(s,"00")):(o.append('<i class="oci oci-spinner spinner"></i>'),e.ajax({url:s,dataType:"json"}).done(function(e,t,n){i.buildHierarchy(a,i.options.ajaxURL?e:i.attachRel(e,"00"),0,i.options)}).fail(function(e,t,i){console.log(i)}).always(function(){o.children(".spinner").remove()})),n.append(o),this.options.exportButton&&!e(".oc-export-btn").length&&this.attachExportButton(),this.options.pan&&this.bindPan(),this.options.zoom&&this.bindZoom(),this},triggerInitEvent:function(){var t=this,i=new MutationObserver(function(n){i.disconnect();initTime:for(var s=0;s<n.length;s++)for(var o=0;o<n[s].addedNodes.length;o++)if(n[s].addedNodes[o].classList.contains("orgchart")){t.options.initCompleted&&"function"==typeof t.options.initCompleted&&t.options.initCompleted(t.$chart);var a=e.Event("init.orgchart");t.$chart.trigger(a);break initTime}});i.observe(this.$chartContainer[0],{childList:!0})},triggerLoadEvent:function(t,i){var n=e.Event("load-"+i+".orgchart");t.trigger(n)},triggerShowEvent:function(t,i){var n=e.Event("show-"+i+".orgchart");t.trigger(n)},triggerHideEvent:function(t,i){var n=e.Event("hide-"+i+".orgchart");t.trigger(n)},attachExportButton:function(){var t=this,i=e("<button>",{class:"oc-export-btn btn btn-sm btn-primary hidden-print",text:this.options.exportButtonName,click:function(e){e.preventDefault(),t.export()}});e("<div>",{class:"button-container"}).appendTo(this.$chartContainer).append(i)},setOptions:function(e,t){return"string"==typeof e&&("pan"===e&&(t?this.bindPan():this.unbindPan()),"zoom"===e&&(t?this.bindZoom():this.unbindZoom())),"object"==typeof e&&(e.data?this.init(e):(void 0!==e.pan&&(e.pan?this.bindPan():this.unbindPan()),void 0!==e.zoom&&(e.zoom?this.bindZoom():this.unbindZoom()))),this},panStartHandler:function(t){var i=e(t.delegateTarget);if(e(t.target).closest(".node").length||t.touches&&t.touches.length>1){i.data("panning",!1);return}i.css("cursor","move").data("panning",!0);var n=0,s=0,o=i.css("transform");if("none"!==o){var a=o.split(",");-1===o.indexOf("3d")?(n=parseInt(a[4]),s=parseInt(a[5])):(n=parseInt(a[12]),s=parseInt(a[13]))}var r=0,d=0;if(t.targetTouches){if(1===t.targetTouches.length)r=t.targetTouches[0].pageX-n,d=t.targetTouches[0].pageY-s;else if(t.targetTouches.length>1)return}else r=t.pageX-n,d=t.pageY-s;i.on("mousemove touchmove",function(e){if(i.data("panning")){var t=0,n=0;if(e.targetTouches){if(1===e.targetTouches.length)t=e.targetTouches[0].pageX-r,n=e.targetTouches[0].pageY-d;else if(e.targetTouches.length>1)return}else t=e.pageX-r,n=e.pageY-d;var s=i.css("transform");if("none"===s)-1===s.indexOf("3d")?i.css("transform","matrix(1, 0, 0, 1, "+t+", "+n+")"):i.css("transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+t+", "+n+", 0, 1)");else{var o=s.split(",");-1===s.indexOf("3d")?(o[4]=" "+t,o[5]=" "+n+")"):(o[12]=" "+t,o[13]=" "+n),i.css("transform",o.join(","))}}})},panEndHandler:function(e){e.data.chart.data("panning")&&e.data.chart.data("panning",!1).css("cursor","default").off("mousemove")},bindPan:function(){this.$chartContainer.css("overflow","hidden"),this.$chart.on("mousedown touchstart",this.panStartHandler),e(i).on("mouseup touchend",{chart:this.$chart},this.panEndHandler)},unbindPan:function(){this.$chartContainer.css("overflow","auto"),this.$chart.off("mousedown touchstart",this.panStartHandler),e(i).off("mouseup touchend",this.panEndHandler)},zoomWheelHandler:function(e){var t=e.data.oc;e.preventDefault();var i=1+(e.originalEvent.deltaY>0?-.2:.2);t.setChartScale(t.$chart,i)},zoomStartHandler:function(e){if(e.touches&&2===e.touches.length){var t=e.data.oc;t.$chart.data("pinching",!0);var i=t.getPinchDist(e);t.$chart.data("pinchDistStart",i)}},zoomingHandler:function(e){var t=e.data.oc;if(t.$chart.data("pinching")){var i=t.getPinchDist(e);t.$chart.data("pinchDistEnd",i)}},zoomEndHandler:function(e){var t=e.data.oc;if(t.$chart.data("pinching")){t.$chart.data("pinching",!1);var i=t.$chart.data("pinchDistEnd")-t.$chart.data("pinchDistStart");i>0?t.setChartScale(t.$chart,1.2):i<0&&t.setChartScale(t.$chart,.8)}},bindZoom:function(){this.$chartContainer.on("wheel",{oc:this},this.zoomWheelHandler),this.$chartContainer.on("touchstart",{oc:this},this.zoomStartHandler),e(i).on("touchmove",{oc:this},this.zoomingHandler),e(i).on("touchend",{oc:this},this.zoomEndHandler)},unbindZoom:function(){this.$chartContainer.off("wheel",this.zoomWheelHandler),this.$chartContainer.off("touchstart",this.zoomStartHandler),e(i).off("touchmove",this.zoomingHandler),e(i).off("touchend",this.zoomEndHandler)},getPinchDist:function(e){return Math.sqrt((e.touches[0].clientX-e.touches[1].clientX)*(e.touches[0].clientX-e.touches[1].clientX)+(e.touches[0].clientY-e.touches[1].clientY)*(e.touches[0].clientY-e.touches[1].clientY))},setChartScale:function(e,i){var n=e.data("options"),s=e.css("transform"),o="",a=1;"none"===s?e.css("transform","scale("+i+","+i+")"):(o=s.split(","),-1===s.indexOf("3d")?(a=Math.abs(t.parseFloat(o[3])*i))>n.zoomoutLimit&&a<n.zoominLimit&&e.css("transform",s+" scale("+i+","+i+")"):(a=Math.abs(t.parseFloat(o[1])*i))>n.zoomoutLimit&&a<n.zoominLimit&&e.css("transform",s+" scale3d("+i+","+i+", 1)"))},buildJsonDS:function(t){var i=this,n={name:t.contents().eq(0).text().trim(),relationship:(t.parent().parent().is("li")?"1":"0")+(t.siblings("li").length?1:0)+(t.children("ul").length?1:0)};return e.each(t.data(),function(e,t){n[e]=t}),t.children("ul").children().each(function(){n.children||(n.children=[]),n.children.push(i.buildJsonDS(e(this)))}),n},attachRel:function(e,t){var i=this;return e.relationship=t+(e.children&&e.children.length>0?1:0),e.children&&e.children.forEach(function(t){(e.isHybrid||e.isVertical)&&(t.isVertical=!0),i.attachRel(t,"1"+(e.children.length>1?1:0))}),e},loopChart:function(t,i){i=null!==i&&i!==n&&i;var s=this,o=t.find(".node:first"),a={id:o[0].id};return i&&e.each(o.data("nodeData"),function(e,t){a[e]=t}),o.siblings(".nodes").children().each(function(){a.children||(a.children=[]),a.children.push(s.loopChart(e(this),i))}),a},getHierarchy:function(e){if(e=null!==e&&e!==n&&e,void 0===this.$chart)return"Error: orgchart does not exist";if(!this.$chart.find(".node").length)return"Error: nodes do not exist";var t=!0;return(this.$chart.find(".node").each(function(){if(!this.id)return t=!1,!1}),t)?this.loopChart(this.$chart,e):"Error: All nodes of orghcart to be exported must have data-id attribute!"},getNodeState:function(e,t){var i={},n=!!e.closest("vertical").length,t=t||"self";if("parent"===t){if(n?(i=e.closest("ul").parents("ul")).length||(i=e.closest(".nodes")).length||(i=e.closest(".vertical").siblings(":first")):i=e.closest(".nodes").siblings(".node"),i.length)return i.is(".hidden")||!i.is(".hidden")&&i.closest(".nodes").is(".hidden")||!i.is(".hidden")&&i.closest(".vertical").is(".hidden")?{exist:!0,visible:!1}:{exist:!0,visible:!0}}else if("children"===t){if((i=n?e.parent().children("ul"):e.siblings(".nodes")).length)return i.is(".hidden")?{exist:!0,visible:!1}:{exist:!0,visible:!0}}else if("siblings"===t){if((i=n?e.closest("ul"):e.parent().siblings()).length&&(!n||i.children("li").length>1))return i.is(".hidden")||i.parent().is(".hidden")||n&&i.closest(".vertical").is(".hidden")?{exist:!0,visible:!1}:{exist:!0,visible:!0}}else if((i=e).length)return i.closest(".nodes").length&&i.closest(".nodes").is(".hidden")||i.closest(".hierarchy").length&&i.closest(".hierarchy").is(".hidden")||i.closest(".vertical").length&&(i.closest(".nodes").is(".hidden")||i.closest(".vertical").is(".hidden"))?{exist:!0,visible:!1}:{exist:!0,visible:!0};return{exist:!1,visible:!1}},getParent:function(e){return this.getRelatedNodes(e,"parent")},getChildren:function(e){return this.getRelatedNodes(e,"children")},getSiblings:function(e){return this.getRelatedNodes(e,"siblings")},getRelatedNodes:function(t,i){return t&&t instanceof e&&t.is(".node")?"parent"===i?t.closest(".nodes").siblings(".node"):"children"===i?t.siblings(".nodes").children(".hierarchy").find(".node:first"):"siblings"===i?t.closest(".hierarchy").siblings().find(".node:first"):e():e()},hideParentEnd:function(t){e(t.target).removeClass("sliding"),t.data.parent.addClass("hidden")},hideParent:function(e){var t=e.closest(".nodes").siblings(".node");t.find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1),this.getNodeState(e,"siblings").visible&&this.hideSiblings(e),e.parent().addClass("isAncestorsCollapsed"),this.getNodeState(t).visible&&t.addClass("sliding slide-down").one("transitionend",{parent:t},this.hideParentEnd),this.getNodeState(t,"parent").visible&&this.hideParent(t)},showParentEnd:function(t){var i=t.data.node;e(t.target).removeClass("sliding"),this.isInAction(i)&&this.switchVerticalArrow(i.children(".topEdge"))},showParent:function(e){var t=e.closest(".nodes").siblings(".node").removeClass("hidden");e.closest(".hierarchy").removeClass("isAncestorsCollapsed"),this.repaint(t[0]),t.addClass("sliding").removeClass("slide-down").one("transitionend",{node:e},this.showParentEnd.bind(this))},stopAjax:function(e){e.find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1)},isVisibleNode:function(t,i){return this.getNodeState(e(i)).visible},hideChildrenEnd:function(e){var t=e.data.node;e.data.animatedNodes.removeClass("sliding"),e.data.animatedNodes.closest(".nodes").addClass("hidden"),this.isInAction(t)&&this.switchVerticalArrow(t.children(".bottomEdge"))},hideChildren:function(e){e.closest(".hierarchy").addClass("isChildrenCollapsed");var t=e.siblings(".nodes");this.stopAjax(t);var i=t.find(".node").filter(this.isVisibleNode.bind(this));t.is(".vertical")||i.closest(".hierarchy").addClass("isCollapsedDescendant"),(t.is(".vertical")||t.find(".vertical").length)&&i.find(".oci-minus-square").removeClass("oci-minus-square").addClass("oci-plus-square"),this.repaint(i.get(0)),i.addClass("sliding slide-up").eq(0).one("transitionend",{animatedNodes:i,lowerLevel:t,node:e},this.hideChildrenEnd.bind(this))},showChildrenEnd:function(e){var t=e.data.node;e.data.animatedNodes.removeClass("sliding"),this.isInAction(t)&&this.switchVerticalArrow(t.children(".bottomEdge"))},showChildren:function(e){e.closest(".hierarchy").removeClass("isChildrenCollapsed");var t=e.siblings(".nodes"),i=t.is(".vertical"),n=i?t.removeClass("hidden").find(".node").filter(this.isVisibleNode.bind(this)):t.removeClass("hidden").children(".hierarchy").find(".node:first").filter(this.isVisibleNode.bind(this));i||(n.filter(":not(:only-child)").closest(".hierarchy").addClass("isChildrenCollapsed"),n.closest(".hierarchy").removeClass("isCollapsedDescendant")),this.repaint(n.get(0)),n.addClass("sliding").removeClass("slide-up").eq(0).one("transitionend",{node:e,animatedNodes:n},this.showChildrenEnd.bind(this))},hideSiblingsEnd:function(e){var t=e.data.node,i=e.data.nodeContainer,n=e.data.direction,s=n?"left"===n?i.prevAll(":not(.hidden)"):i.nextAll(":not(.hidden)"):i.siblings();e.data.animatedNodes.removeClass("sliding"),s.find(".node:gt(0)").filter(this.isVisibleNode.bind(this)).removeClass("slide-left slide-right").addClass("slide-up"),s.find(".nodes, .vertical").addClass("hidden").end().addClass("hidden"),this.isInAction(t)&&this.switchHorizontalArrow(t)},hideSiblings:function(e,t){var i=e.closest(".hierarchy").addClass("isSiblingsCollapsed");i.siblings().find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1),t?"left"===t?i.addClass("left-sibs").prevAll(".isSiblingsCollapsed").removeClass("isSiblingsCollapsed left-sibs").end().prevAll().addClass("isCollapsedSibling isChildrenCollapsed").find(".node").filter(this.isVisibleNode.bind(this)).addClass("sliding slide-right"):i.addClass("right-sibs").nextAll(".isSiblingsCollapsed").removeClass("isSiblingsCollapsed right-sibs").end().nextAll().addClass("isCollapsedSibling isChildrenCollapsed").find(".node").filter(this.isVisibleNode.bind(this)).addClass("sliding slide-left"):(i.prevAll().find(".node").filter(this.isVisibleNode.bind(this)).addClass("sliding slide-right"),i.nextAll().find(".node").filter(this.isVisibleNode.bind(this)).addClass("sliding slide-left"),i.siblings().addClass("isCollapsedSibling isChildrenCollapsed"));var n=i.siblings().find(".sliding");n.eq(0).one("transitionend",{node:e,nodeContainer:i,direction:t,animatedNodes:n},this.hideSiblingsEnd.bind(this))},showSiblingsEnd:function(e){var t=e.data.node;e.data.visibleNodes.removeClass("sliding"),this.isInAction(t)&&(this.switchHorizontalArrow(t),t.children(".topEdge").removeClass("oci-chevron-up").addClass("oci-chevron-down"))},showRelatedParentEnd:function(t){e(t.target).removeClass("sliding")},showSiblings:function(t,i){var n=e(),s=t.closest(".hierarchy");n=i?"left"===i?s.prevAll().removeClass("hidden"):s.nextAll().removeClass("hidden"):t.closest(".hierarchy").siblings().removeClass("hidden");var o=t.closest(".nodes").siblings(".node");i?(s.removeClass(i+"-sibs"),s.is("[class*=-sibs]")||s.removeClass("isSiblingsCollapsed"),n.removeClass("isCollapsedSibling "+i+"-sibs")):(t.closest(".hierarchy").removeClass("isSiblingsCollapsed"),n.removeClass("isCollapsedSibling")),this.getNodeState(t,"parent").visible||(t.closest(".hierarchy").removeClass("isAncestorsCollapsed"),o.removeClass("hidden"),this.repaint(o[0]),o.addClass("sliding").removeClass("slide-down").one("transitionend",this.showRelatedParentEnd));var a=n.find(".node").filter(this.isVisibleNode.bind(this));this.repaint(a.get(0)),a.addClass("sliding").removeClass("slide-left slide-right"),a.eq(0).one("transitionend",{node:t,visibleNodes:a},this.showSiblingsEnd.bind(this))},startLoading:function(t){var i=this.$chart;return(void 0===i.data("inAjax")||!0!==i.data("inAjax"))&&(t.addClass("hidden"),t.parent().append('<i class="oci oci-spinner spinner"></i>').children().not(".spinner").css("opacity",.2),i.data("inAjax",!0),e(".oc-export-btn").prop("disabled",!0),!0)},endLoading:function(t){var i=t.parent();t.removeClass("hidden"),i.find(".spinner").remove(),i.children().removeAttr("style"),this.$chart.data("inAjax",!1),e(".oc-export-btn").prop("disabled",!1)},isInAction:function(e){return e.children(".edge").attr("class").indexOf("oci-")>-1},switchVerticalArrow:function(e){e.toggleClass("oci-chevron-up").toggleClass("oci-chevron-down")},switchHorizontalArrow:function(e){var t=this.options;if(t.toggleSiblingsResp&&(void 0===t.ajaxURL||e.closest(".nodes").data("siblingsLoaded"))){var i=e.parent().prev();i.length&&(i.is(".hidden")?e.children(".leftEdge").addClass("oci-chevron-left").removeClass("oci-chevron-right"):e.children(".leftEdge").addClass("oci-chevron-right").removeClass("oci-chevron-left"));var n=e.parent().next();n.length&&(n.is(".hidden")?e.children(".rightEdge").addClass("oci-chevron-right").removeClass("oci-chevron-left"):e.children(".rightEdge").addClass("oci-chevron-left").removeClass("oci-chevron-right"))}else{var s=e.parent().siblings(),o=!!s.length&&!s.is(".hidden");e.children(".leftEdge").toggleClass("oci-chevron-right",o).toggleClass("oci-chevron-left",!o),e.children(".rightEdge").toggleClass("oci-chevron-left",o).toggleClass("oci-chevron-right",!o)}},repaint:function(e){e&&(e.style.offsetWidth=e.offsetWidth)},nodeEnterLeaveHandler:function(t){var i=e(t.delegateTarget),n=!1;if(i.closest(".nodes.vertical").length){var s=i.children(".toggleBtn");"mouseenter"===t.type?i.children(".toggleBtn").length&&(n=this.getNodeState(i,"children").visible,s.toggleClass("oci-plus-square",!n).toggleClass("oci-minus-square",n)):s.removeClass("oci-plus-square oci-minus-square")}else{var o=i.children(".topEdge");i.children(".rightEdge");var a=i.children(".bottomEdge"),r=i.children(".leftEdge");"mouseenter"===t.type?(o.length&&(n=this.getNodeState(i,"parent").visible,o.toggleClass("oci-chevron-up",!n).toggleClass("oci-chevron-down",n)),a.length&&(n=this.getNodeState(i,"children").visible,a.toggleClass("oci-chevron-down",!n).toggleClass("oci-chevron-up",n)),r.length&&this.switchHorizontalArrow(i)):i.children(".edge").removeClass("oci-chevron-up oci-chevron-down oci-chevron-right oci-chevron-left")}},nodeClickHandler:function(t){this.$chart.find(".focused").removeClass("focused"),e(t.delegateTarget).addClass("focused")},loadNodes:function(t,i,n){var s=this;this.options,e.ajax({url:i,dataType:"json"}).done(function(i){s.$chart.data("inAjax")&&("parent"===t?e.isEmptyObject(i)||s.addParent(n.parent(),i):"children"===t?i.children.length&&s.addChildren(n.parent(),i[t]):s.addSiblings(n.parent(),i.siblings?i.siblings:i),s.triggerLoadEvent(n.parent(),t))}).fail(function(){console.log("Failed to get "+t+" data")}).always(function(){s.endLoading(n)})},HideFirstParentEnd:function(e){var t=e.data.topEdge,i=t.parent();this.isInAction(i)&&(this.switchVerticalArrow(t),this.switchHorizontalArrow(i))},topEdgeClickHandler:function(t){t.stopPropagation();var i=e(t.target),n=e(t.delegateTarget),s=this.getNodeState(n,"parent");if(s.exist){var o=n.closest(".nodes").siblings(".node");if(o.is(".sliding"))return;s.visible?(this.hideParent(n),o.one("transitionend",{topEdge:i},this.HideFirstParentEnd.bind(this)),this.triggerHideEvent(n,"parent")):(this.showParent(n),this.triggerShowEvent(n,"parent"))}else if(this.startLoading(i)){var a=this.options,r=e.isFunction(a.ajaxURL.parent)?a.ajaxURL.parent(n.data("nodeData")):a.ajaxURL.parent+n[0].id;this.loadNodes("parent",r,i)}},bottomEdgeClickHandler:function(t){t.stopPropagation();var i=e(t.target),n=e(t.delegateTarget),s=this.getNodeState(n,"children");if(s.exist){if(n.siblings(".nodes").children().children(".node").is(".sliding"))return;s.visible?(this.hideChildren(n),this.triggerHideEvent(n,"children")):(this.showChildren(n),this.triggerShowEvent(n,"children"))}else if(this.startLoading(i)){var o=this.options,a=e.isFunction(o.ajaxURL.children)?o.ajaxURL.children(n.data("nodeData")):o.ajaxURL.children+n[0].id;this.loadNodes("children",a,i)}},hEdgeClickHandler:function(t){t.stopPropagation();var i=e(t.target),n=e(t.delegateTarget),s=this.options,o=this.getNodeState(n,"siblings");if(o.exist){if(n.closest(".hierarchy").siblings().find(".sliding").length)return;if(s.toggleSiblingsResp){var a=n.closest(".hierarchy").prev(),r=n.closest(".hierarchy").next();i.is(".leftEdge")?a.is(".hidden")?(this.showSiblings(n,"left"),this.triggerShowEvent(n,"siblings")):(this.hideSiblings(n,"left"),this.triggerHideEvent(n,"siblings")):r.is(".hidden")?(this.showSiblings(n,"right"),this.triggerShowEvent(n,"siblings")):(this.hideSiblings(n,"right"),this.triggerHideEvent(n,"siblings"))}else o.visible?(this.hideSiblings(n),this.triggerHideEvent(n,"siblings")):(this.showSiblings(n),this.triggerShowEvent(n,"siblings"))}else if(this.startLoading(i)){var d=n[0].id,l=this.getNodeState(n,"parent").exist?e.isFunction(s.ajaxURL.siblings)?s.ajaxURL.siblings(n.data("nodeData")):s.ajaxURL.siblings+d:e.isFunction(s.ajaxURL.families)?s.ajaxURL.families(n.data("nodeData")):s.ajaxURL.families+d;this.loadNodes("siblings",l,i)}},expandVNodesEnd:function(e){e.data.vNodes.removeClass("sliding")},collapseVNodesEnd:function(e){e.data.vNodes.removeClass("sliding").closest("ul").addClass("hidden")},toggleVNodes:function(t){var i=e(t.target),n=i.parent().next(),s=n.find(".node"),o=n.children().children(".node");!o.is(".sliding")&&(i.toggleClass("oci-plus-square oci-minus-square"),s.eq(0).is(".slide-up")?(n.removeClass("hidden"),this.repaint(o.get(0)),o.addClass("sliding").removeClass("slide-up").eq(0).one("transitionend",{vNodes:o},this.expandVNodesEnd)):(s.addClass("sliding slide-up").eq(0).one("transitionend",{vNodes:s},this.collapseVNodesEnd),s.find(".toggleBtn").removeClass("oci-minus-square oci-plus-square")))},createGhostNode:function(n){var s,o,a=e(n.target),r=this.options,d=n.originalEvent,l=/firefox/.test(t.navigator.userAgent.toLowerCase());if(i.querySelector(".ghost-node"))o=e(s=a.closest(".orgchart").children(".ghost-node").get(0)).children().get(0);else{if(!(s=i.createElementNS("http://www.w3.org/2000/svg","svg")).classList)return;s.classList.add("ghost-node"),o=i.createElementNS("http://www.w3.org/2000/svg","rect"),s.appendChild(o),a.closest(".orgchart").append(s)}var h=a.closest(".orgchart").css("transform").split(","),c="t2b"===r.direction||"b2t"===r.direction,g=Math.abs(t.parseFloat(c?h[0].slice(h[0].indexOf("(")+1):h[1]));s.setAttribute("width",c?a.outerWidth(!1):a.outerHeight(!1)),s.setAttribute("height",c?a.outerHeight(!1):a.outerWidth(!1)),o.setAttribute("x",5*g),o.setAttribute("y",5*g),o.setAttribute("width",120*g),o.setAttribute("height",40*g),o.setAttribute("rx",4*g),o.setAttribute("ry",4*g),o.setAttribute("stroke-width",1*g);var p=d.offsetX*g,f=d.offsetY*g;if("l2r"===r.direction?(p=d.offsetY*g,f=d.offsetX*g):"r2l"===r.direction?(p=a.outerWidth(!1)-d.offsetY*g,f=d.offsetX*g):"b2t"===r.direction&&(p=a.outerWidth(!1)-d.offsetX*g,f=a.outerHeight(!1)-d.offsetY*g),l){o.setAttribute("fill","rgb(255, 255, 255)"),o.setAttribute("stroke","rgb(191, 0, 0)");var u=i.createElement("img");u.src="data:image/svg+xml;utf8,"+new XMLSerializer().serializeToString(s),d.dataTransfer.setDragImage(u,p,f)}else d.dataTransfer.setDragImage&&d.dataTransfer.setDragImage(s,p,f)},getUpperLevel:function(e){return e.is(".node")?e.parents(".hierarchy").length:0},getLowerLevel:function(e){return e.is(".node")?e.closest(".hierarchy").find(".nodes").length+1:0},getLevelOrderNodes:function(t){if(!t)return[];var i=[],n=[];for(i.push(t);i.length;){for(var s=[],o=0;o<i.length;o++){var a=i.shift(),r=this.getChildren(a);r.length&&i.push(r.toArray().flat()),s.push(e(a))}n.push(s)}return n},filterAllowedDropNodes:function(t){var i=this.options,n=t.closest("[draggable]").hasClass("node"),s=t.closest(".nodes").siblings(".node"),o=t.closest(".hierarchy").find(".node");this.$chart.data("dragged",t).find(".node").each(function(a,r){(!n||-1===o.index(r))&&(i.dropCriteria?i.dropCriteria(t,s,e(r))&&e(r).addClass("allowedDrop"):e(r).addClass("allowedDrop"))})},dragstartHandler:function(t){t.originalEvent.dataTransfer.setData("text/html","hack for firefox"),"none"!==this.$chart.css("transform")&&this.createGhostNode(t),this.filterAllowedDropNodes(e(t.target))},dragoverHandler:function(t){e(t.delegateTarget).is(".allowedDrop")?t.preventDefault():t.originalEvent.dataTransfer.dropEffect="none"},dragendHandler:function(e){this.$chart.find(".allowedDrop").removeClass("allowedDrop")},dropHandler:async function(t){var i=e(t.delegateTarget),n=this.$chart.data("dragged");if(!n.hasClass("node")){this.$chart.triggerHandler({type:"otherdropped.orgchart",draggedItem:n,dropZone:i});return}if(!i.hasClass("allowedDrop"))return;var s=n.closest(".nodes").siblings(".node"),o=e.Event("nodedrop.orgchart");if(this.$chart.trigger(o,{draggedNode:n,dragZone:s,dropZone:i}),o.isDefaultPrevented())return;var a=this.$chart.data("options").data,r=new JSONDigger(a,this.$chart.data("options").nodeId,"children");let d=r.findOneNode({isHybrid:!0});if(this.$chart.data("options").verticalLevel>1||d){var l=r.findNodeById(n.data("nodeData").id),h=Object.assign({},l);r.removeNode(l.id);var c=r.findNodeById(i.data("nodeData").id);c.children?c.children.push(h):c.children=[h],this.init({data:a})}else{if(i.siblings(".nodes").length){var g='<i class="edge horizontalEdge rightEdge oci"></i><i class="edge horizontalEdge leftEdge oci"></i>';n.find(".horizontalEdge").length||n.append(g),i.siblings(".nodes").append(n.closest(".hierarchy"));var p=n.closest(".hierarchy").siblings().find(".node:first");1===p.length&&p.append(g)}else i.append('<i class="edge verticalEdge bottomEdge oci"></i>').after('<ul class="nodes"></ul>').siblings(".nodes").append(n.find(".horizontalEdge").remove().end().closest(".hierarchy")),i.children(".title").length&&i.children(".title").prepend('<i class="oci '+this.$chart.data("options").parentNodeSymbol+' symbol"></i>');1===s.siblings(".nodes").children(".hierarchy").length?s.siblings(".nodes").children(".hierarchy").find(".node:first").find(".horizontalEdge").remove():0===s.siblings(".nodes").children(".hierarchy").length&&s.find(".bottomEdge, .symbol").remove().end().siblings(".nodes").remove()}},touchstartHandler:function(e){!this.touchHandled&&(e.touches&&e.touches.length>1||(this.touchHandled=!0,this.touchMoved=!1,e.preventDefault()))},touchmoveHandler:function(t){if(this.touchHandled&&(!t.touches||!(t.touches.length>1))){t.preventDefault(),this.touchMoved||(this.filterAllowedDropNodes(e(t.currentTarget)),this.touchDragImage=this.createDragImage(t,this.$chart.data("dragged")[0])),this.touchMoved=!0,this.moveDragImage(t,this.touchDragImage);var n=e(i.elementFromPoint(t.touches[0].clientX,t.touches[0].clientY)).closest("div.node");if(n.length>0){var s=n[0];n.is(".allowedDrop")?this.touchTargetNode=s:this.touchTargetNode=null}else this.touchTargetNode=null}},touchendHandler:function(e){if(this.touchHandled){if(this.destroyDragImage(),this.touchMoved){if(this.touchTargetNode){var n={delegateTarget:this.touchTargetNode};this.dropHandler(n),this.touchTargetNode=null}this.dragendHandler(e)}else{var s=e.changedTouches[0],o=i.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,t,1,s.screenX,s.screenY,s.clientX,s.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),e.target.dispatchEvent(o)}this.touchHandled=!1}},createDragImage:function(e,t){var n=t.cloneNode(!0);this.copyStyle(t,n),n.style.top=n.style.left="-9999px";var s=t.getBoundingClientRect(),o=this.getTouchPoint(e);return this.touchDragImageOffset={x:o.x-s.left,y:o.y-s.top},n.style.opacity="0.5",i.body.appendChild(n),n},destroyDragImage:function(){this.touchDragImage&&this.touchDragImage.parentElement&&this.touchDragImage.parentElement.removeChild(this.touchDragImage),this.touchDragImageOffset=null,this.touchDragImage=null},copyStyle:function(e,t){if(["id","class","style","draggable"].forEach(function(e){t.removeAttribute(e)}),e instanceof HTMLCanvasElement){var i=e,n=t;n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0)}for(var s=getComputedStyle(e),o=0;o<s.length;o++){var a=s[o];0>a.indexOf("transition")&&(t.style[a]=s[a])}t.style.pointerEvents="none";for(var o=0;o<e.children.length;o++)this.copyStyle(e.children[o],t.children[o])},getTouchPoint:function(e){return e&&e.touches&&(e=e.touches[0]),{x:e.clientX,y:e.clientY}},moveDragImage:function(e,t){if(e&&t){var i=this;requestAnimationFrame(function(){var n=i.getTouchPoint(e),s=t.style;s.position="absolute",s.pointerEvents="none",s.zIndex="999999",i.touchDragImageOffset&&(s.left=Math.round(n.x-i.touchDragImageOffset.x)+"px",s.top=Math.round(n.y-i.touchDragImageOffset.y)+"px")})}},bindDragDrop:function(e){e.on("dragstart",this.dragstartHandler.bind(this)).on("dragover",this.dragoverHandler.bind(this)).on("dragend",this.dragendHandler.bind(this)).on("drop",this.dropHandler.bind(this)).on("touchstart",this.touchstartHandler.bind(this)).on("touchmove",this.touchmoveHandler.bind(this)).on("touchend",this.touchendHandler.bind(this))},createNode:function(t){var i=this.options,n=t.level;t.children&&t[i.nodeId]&&e.each(t.children,function(e,n){n.parentId=t[i.nodeId]});var s=e("<div"+(i.draggable?' draggable="true"':"")+(t[i.nodeId]?' id="'+t[i.nodeId]+'"':"")+(t.parentId?' data-parent="'+t.parentId+'"':"")+">").addClass("node "+(t.className||"")+(n>i.visibleLevel?" slide-up":""));i.nodeTemplate?s.append(i.nodeTemplate(t)):s.append('<div class="title">'+t[i.nodeTitle]+"</div>").append(void 0!==i.nodeContent?'<div class="content">'+(t[i.nodeContent]||"")+"</div>":"");var o=e.extend({},t);delete o.children,s.data("nodeData",o);var a=t.relationship||"";return i.verticalLevel&&n>=i.verticalLevel||t.isVertical?Number(a.substr(2,1))&&s.append('<i class="toggleBtn oci"></i>').children(".title").prepend('<i class="oci '+i.parentNodeSymbol+' symbol"></i>'):(t.isHybrid||(Number(a.substr(0,1))&&s.append('<i class="edge verticalEdge topEdge oci"></i>'),Number(a.substr(1,1))&&s.append('<i class="edge horizontalEdge rightEdge oci"></i><i class="edge horizontalEdge leftEdge oci"></i>')),Number(a.substr(2,1))&&s.append('<i class="edge verticalEdge bottomEdge oci"></i>').children(".title").prepend('<i class="oci '+i.parentNodeSymbol+' symbol"></i>')),s.on("mouseenter mouseleave",this.nodeEnterLeaveHandler.bind(this)),s.on("click",this.nodeClickHandler.bind(this)),s.on("click",".topEdge",this.topEdgeClickHandler.bind(this)),s.on("click",".bottomEdge",this.bottomEdgeClickHandler.bind(this)),s.on("click",".leftEdge, .rightEdge",this.hEdgeClickHandler.bind(this)),s.on("click",".toggleBtn",this.toggleVNodes.bind(this)),i.draggable&&(this.bindDragDrop(s),this.touchHandled=!1,this.touchMoved=!1,this.touchTargetNode=null),i.createNode&&i.createNode(s,t),s},buildHierarchy:function(t,i){var s=this,o=this.options,a=0;if(a=i.level?i.level:i.level=t.parentsUntil(".orgchart",".nodes").length,Object.keys(i).length>2&&t.append(this.createNode(i)),i.children&&i.children.length){var r,d=a+1>o.visibleLevel||n!==i.collapsed&&i.collapsed;o.verticalLevel&&a+1>=o.verticalLevel||i.isHybrid?(r=e('<ul class="nodes">'),d&&o.verticalLevel&&a+1>=o.verticalLevel&&r.addClass("hidden"),(o.verticalLevel&&a+1===o.verticalLevel||i.isHybrid)&&!t.closest(".vertical").length?t.append(r.addClass("vertical")):t.append(r)):(r=e('<ul class="nodes'+(d?" hidden":"")+'">'),2===Object.keys(i).length||d&&t.addClass("isChildrenCollapsed"),t.append(r)),e.each(i.children,function(){var t=e('<li class="hierarchy">');r.append(t),this.level=a+1,s.buildHierarchy(t,this)})}},buildChildNode:function(e,t){this.buildHierarchy(e,{children:t})},addChildren:function(e,t){this.buildChildNode(e.closest(".hierarchy"),t),e.find(".symbol").length||e.children(".title").prepend('<i class="oci '+this.options.parentNodeSymbol+' symbol"></i>'),e.closest(".nodes.vertical").length?e.children(".toggleBtn").length||e.append('<i class="toggleBtn oci"></i>'):e.children(".bottomEdge").length||e.append('<i class="edge verticalEdge bottomEdge oci"></i>'),this.isInAction(e)&&this.switchVerticalArrow(e.children(".bottomEdge"))},buildParentNode:function(t,i){i.relationship=i.relationship||"001";var n=e('<ul class="nodes"><li class="hierarchy"></li></ul>').find(".hierarchy").append(this.createNode(i)).end();this.$chart.prepend(n).find(".hierarchy:first").append(t.closest("ul").addClass("nodes"))},addParent:function(e,t){this.buildParentNode(e,t),e.children(".topEdge").length||e.children(".title").after('<i class="edge verticalEdge topEdge oci"></i>'),this.isInAction(e)&&this.switchVerticalArrow(e.children(".topEdge"))},buildSiblingNode:function(t,i){var n=e.isArray(i)?i.length:i.children.length,s=t.parent().is(".nodes")?t.siblings().length+1:1,o=s+n,a=o>1?Math.floor(o/2-1):0;if(t.closest(".nodes").parent().is(".hierarchy")){this.buildChildNode(t.parent().closest(".hierarchy"),i);var r=t.parent().closest(".hierarchy").children(".nodes:last").children(".hierarchy");s>1?r.eq(0).before(t.siblings().addBack().unwrap()):r.eq(a).after(t.unwrap())}else this.buildHierarchy(t.parent().prepend(e('<li class="hierarchy">')).children(".hierarchy:first"),i),t.prevAll(".hierarchy").children(".nodes").children().eq(a).after(t)},addSiblings:function(e,t){this.buildSiblingNode(e.closest(".hierarchy"),t),e.closest(".nodes").data("siblingsLoaded",!0),e.children(".leftEdge").length||e.children(".topEdge").after('<i class="edge horizontalEdge rightEdge oci"></i><i class="edge horizontalEdge leftEdge oci"></i>'),this.isInAction(e)&&(this.switchHorizontalArrow(e),e.children(".topEdge").removeClass("oci-chevron-up").addClass("oci-chevron-down"))},removeNodes:function(e){var t=e.closest(".hierarchy").parent();t.parent().is(".hierarchy")?this.getNodeState(e,"siblings").exist?(e.closest(".hierarchy").remove(),1===t.children().length&&t.find(".node:first .horizontalEdge").remove()):t.siblings(".node").find(".bottomEdge").remove().end().end().remove():t.closest(".orgchart").remove()},hideDropZones:function(){this.$chart.find(".allowedDrop").removeClass("allowedDrop")},showDropZones:function(t){this.$chart.find(".node").each(function(t,i){e(i).addClass("allowedDrop")}),this.$chart.data("dragged",e(t))},processExternalDrop:function(t,i){i&&this.$chart.data("dragged",e(i)),t.closest(".node").triggerHandler({type:"drop"})},exportPDF:function(e,i){var n={},s=Math.floor(e.width),o=Math.floor(e.height);t.jsPDF||(t.jsPDF=t.jspdf.jsPDF),(n=new jsPDF(s>o?{orientation:"landscape",unit:"px",format:[s,o]}:{orientation:"portrait",unit:"px",format:[o,s]})).addImage(e.toDataURL(),"png",0,0),n.save(i+".pdf")},exportPNG:function(e,n){var s="WebkitAppearance"in i.documentElement.style,o=!!t.sidebar,a="Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&navigator.appVersion.indexOf("Edge")>-1,r=this.$chartContainer;if((s||o)&&!a){var d=".oci-download-btn"+(""!==this.options.chartClass?"."+this.options.chartClass:"");r.find(d).length||r.append('<a class="oci-download-btn'+(""!==this.options.chartClass?" "+this.options.chartClass:"")+'" download="'+n+'.png"></a>'),r.find(d).attr("href",e.toDataURL())[0].click()}else t.navigator.msSaveBlob(e.msToBlob(),n+".png")},export:function(t,i){var n=this;if(t=void 0!==t?t:this.options.exportFilename,i=void 0!==i?i:this.options.exportFileextension,e(this).children(".spinner").length)return!1;var s=this.$chartContainer,o=s.find(".mask");o.length?o.removeClass("hidden"):s.append('<div class="mask"><i class="oci oci-spinner spinner"></i></div>');var a=s.addClass("canvasContainer").find('.orgchart:not(".hidden")').get(0),r="l2r"===n.options.direction||"r2l"===n.options.direction;html2canvas(a,{width:r?a.clientHeight:a.clientWidth,height:r?a.clientWidth:a.clientHeight,onclone:function(t){e(t).find(".canvasContainer").css("overflow","visible").find('.orgchart:not(".hidden"):first').css("transform","")}}).then(function(e){s.find(".mask").addClass("hidden"),"pdf"===i.toLowerCase()?n.exportPDF(e,t):n.exportPNG(e,t),s.removeClass("canvasContainer")},function(){s.removeClass("canvasContainer")})}},e.fn.orgchart=function(e){return new s(this,e).init()}},factory("object"==typeof module&&"object"==typeof module.exports?require("jquery"):jQuery,window,document);